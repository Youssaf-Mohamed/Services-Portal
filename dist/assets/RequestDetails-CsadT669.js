import{_ as K,i as Q,h as X,j as N,k as l,r as v,g as S,z as Y,e as Z,o as n,l as d,c as i,a as s,t as o,p as u,d as r,b as E,v as F,A as I,C as ee}from"./index-Bc4wcCny.js";import{a as se,P as te,B as f}from"./PageHeader-DedF_tvu.js";import{C as P}from"./Card-BNSDWmXW.js";import{B as h}from"./Badge-DkpUI6Z9.js";import{M as L}from"./Modal-BPzgvptH.js";import{a as R}from"./adminTransport.api-C7MzCjLU.js";/* empty css                                                             *//* empty css                                                              *//* empty css                                                              */const ae={key:0,class:"loading-state"},oe={key:1,class:"error-state"},le={key:2,class:"details-content"},ne={class:"details-grid"},ie={class:"status-display"},re={class:"status-date"},ue={key:0,class:"actions-section"},de={key:1,class:"approval-info"},ve={key:0},pe={key:1},fe={key:2,class:"rejection-reason"},ce={key:2,class:"subscription-info"},me={key:0},_e={class:"info-grid"},ye={class:"info-item"},ge={class:"info-value"},be={class:"info-item"},ke={class:"info-value"},Re={key:0,class:"info-item"},je={class:"info-value"},we={class:"info-grid"},qe={class:"info-item"},Ce={class:"info-value"},Pe={class:"info-item"},Ae={class:"info-value"},De={class:"info-item"},xe={class:"info-value"},Ne={class:"info-item"},Se={class:"info-value"},he={class:"info-item"},Te={class:"info-grid"},Be={class:"info-item"},Ee={class:"info-value"},Fe={class:"info-item"},Ie={class:"info-value"},Le={class:"info-item"},Me={class:"info-value amount"},Ue={key:0,class:"info-item"},Ve={class:"info-value"},$e={key:0,class:"proof-section"},ze={key:0,class:"proof-loading"},Oe={key:1,class:"proof-image-container"},Ge=["src"],He={key:2,class:"proof-error"},We=["href"],Je={class:"modal-body"},Ke={class:"form-group"},Qe=["min"],Xe={key:0,class:"processing"},Ye={key:1,class:"error-text"},Ze={class:"modal-body"},es={class:"form-group"},ss={class:"char-count"},ts={key:0,class:"processing"},as={key:1,class:"error-text"},os={__name:"RequestDetails",setup(ls){const T=ee(),M=Y();Z();const c=S(()=>M.params.id),A=v(!0),j=v(null),t=v(null),_=v(!1),y=v(!1),g=v(!1),b=v(!1),w=v(null),q=v(null),C=I({start_date:""}),k=I({rejection_reason:""}),D=v(!1),m=v(null),U=S(()=>new Date().toISOString().split("T")[0]),V=S(()=>R.getProofUrl(c.value)),$=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],B=async()=>{try{A.value=!0,j.value=null;const a=await R.getRequest(c.value);a.data.success&&(t.value=a.data.data)}catch(a){j.value=a.response?.data?.message||"Failed to load request"}finally{A.value=!1}},z=async()=>{try{g.value=!0,w.value=null;const a={};C.start_date&&(a.start_date=C.start_date);const e=await R.approveRequest(c.value,a);e.data.success&&(_.value=!1,t.value=e.data.data.request,T.success(e.data.data.message))}catch(a){w.value=a.response?.data?.message||"Failed to approve request"}finally{g.value=!1}},O=async()=>{try{b.value=!0,q.value=null;const a=await R.rejectRequest(c.value,{rejection_reason:k.rejection_reason});a.data.success&&(y.value=!1,t.value=a.data.data.request,T.success("Request rejected successfully"))}catch(a){q.value=a.response?.data?.message||"Failed to reject request"}finally{b.value=!1}},G=a=>{switch(a){case"pending":return"warning";case"approved":return"success";case"rejected":return"danger";default:return"secondary"}},x=a=>a?new Date(a).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A",H=a=>$[a]||"N/A",W=async()=>{if(t.value?.proof_exists)try{D.value=!0;const a=await R.downloadProof(c.value),e=new Blob([a.data],{type:a.headers["content-type"]});m.value=URL.createObjectURL(e)}catch(a){console.error("Failed to load proof image:",a),m.value=null}finally{D.value=!1}},J=()=>{m.value&&window.open(m.value,"_blank")};return Q(B),X(()=>t.value?.proof_exists,a=>{a&&W()},{immediate:!0}),(a,e)=>(n(),N(se,null,{default:l(()=>[d(te,{title:"Request Details",subtitle:"Review subscription request and take action",breadcrumbs:[{label:"Admin",to:"/admin/transport"},{label:"Requests",to:"/admin/transport/requests"},{label:`Request #${c.value}`}]},null,8,["breadcrumbs"]),A.value?(n(),i("div",ae,[...e[8]||(e[8]=[s("div",{class:"spinner"},null,-1),s("p",null,"Loading request details...",-1)])])):j.value?(n(),i("div",oe,[s("p",null,o(j.value),1),d(f,{variant:"primary",onClick:B},{default:l(()=>[...e[9]||(e[9]=[u("Retry",-1)])]),_:1})])):t.value?(n(),i("div",le,[s("div",ne,[d(P,{class:"status-card"},{header:l(()=>[...e[10]||(e[10]=[s("h3",null,"Status",-1)])]),default:l(()=>[s("div",ie,[d(h,{variant:G(t.value.status),size:"lg"},{default:l(()=>[u(o(t.value.status),1)]),_:1},8,["variant"]),s("p",re," Submitted: "+o(x(t.value.created_at)),1)]),t.value.status==="pending"?(n(),i("div",ue,[d(f,{variant:"primary",onClick:e[0]||(e[0]=p=>_.value=!0)},{default:l(()=>[...e[11]||(e[11]=[u(" âœ“ Approve ",-1)])]),_:1}),d(f,{variant:"danger",onClick:e[1]||(e[1]=p=>y.value=!0)},{default:l(()=>[...e[12]||(e[12]=[u(" âœ• Reject ",-1)])]),_:1})])):r("",!0),t.value.approver?(n(),i("div",de,[t.value.status==="approved"?(n(),i("p",ve,[e[13]||(e[13]=u(" Approved by ",-1)),s("strong",null,o(t.value.approver.name),1),u(" on "+o(x(t.value.approved_at)),1)])):r("",!0),t.value.status==="rejected"?(n(),i("p",pe,[e[14]||(e[14]=u(" Rejected by ",-1)),s("strong",null,o(t.value.approver.name),1),u(" on "+o(x(t.value.approved_at)),1)])):r("",!0),t.value.rejection_reason?(n(),i("p",fe," Reason: "+o(t.value.rejection_reason),1)):r("",!0)])):r("",!0),t.value.subscription?(n(),i("div",ce,[e[15]||(e[15]=s("h4",null,"Subscription Created",-1)),d(h,{variant:t.value.subscription.status==="active"?"success":"warning"},{default:l(()=>[u(o(t.value.subscription.status),1)]),_:1},8,["variant"]),s("p",null,"Start: "+o(t.value.subscription.start_date),1),s("p",null,"End: "+o(t.value.subscription.end_date),1),t.value.subscription.days_remaining!==null?(n(),i("p",me," Days remaining: "+o(t.value.subscription.days_remaining),1)):r("",!0)])):r("",!0)]),_:1}),d(P,null,{header:l(()=>[...e[16]||(e[16]=[s("h3",null,"Student Information",-1)])]),default:l(()=>[s("div",_e,[s("div",ye,[e[17]||(e[17]=s("span",{class:"info-label"},"Name",-1)),s("span",ge,o(t.value.user.name),1)]),s("div",be,[e[18]||(e[18]=s("span",{class:"info-label"},"Email",-1)),s("span",ke,o(t.value.user.email),1)]),t.value.user.student_id?(n(),i("div",Re,[e[19]||(e[19]=s("span",{class:"info-label"},"Student ID",-1)),s("span",je,o(t.value.user.student_id),1)])):r("",!0)])]),_:1}),d(P,null,{header:l(()=>[...e[20]||(e[20]=[s("h3",null,"Route & Schedule",-1)])]),default:l(()=>[s("div",we,[s("div",qe,[e[21]||(e[21]=s("span",{class:"info-label"},"Route",-1)),s("span",Ce,o(t.value.route?.name_en||"N/A"),1)]),s("div",Pe,[e[22]||(e[22]=s("span",{class:"info-label"},"Day",-1)),s("span",Ae,o(H(t.value.slot?.day_of_week)),1)]),s("div",De,[e[23]||(e[23]=s("span",{class:"info-label"},"Time",-1)),s("span",xe,o(t.value.slot?.time||"N/A"),1)]),s("div",Ne,[e[24]||(e[24]=s("span",{class:"info-label"},"Direction",-1)),s("span",Se,o(t.value.slot?.direction||"N/A"),1)]),s("div",he,[e[25]||(e[25]=s("span",{class:"info-label"},"Plan Type",-1)),d(h,{variant:t.value.plan_type==="monthly"?"info":"secondary"},{default:l(()=>[u(o(t.value.plan_type),1)]),_:1},8,["variant"])])])]),_:1}),d(P,null,{header:l(()=>[...e[26]||(e[26]=[s("h3",null,"Payment Details",-1)])]),default:l(()=>[s("div",Te,[s("div",Be,[e[27]||(e[27]=s("span",{class:"info-label"},"Payment Method",-1)),s("span",Ee,o(t.value.payment_method?.name||"N/A"),1)]),s("div",Fe,[e[28]||(e[28]=s("span",{class:"info-label"},"Paid From",-1)),s("span",Ie,o(t.value.paid_from_number||"N/A"),1)]),s("div",Le,[e[29]||(e[29]=s("span",{class:"info-label"},"Amount Expected",-1)),s("span",Me,o(t.value.amount_expected)+" EGP",1)]),t.value.pricing_snapshot?(n(),i("div",Ue,[e[30]||(e[30]=s("span",{class:"info-label"},"Discount",-1)),s("span",Ve,o(t.value.pricing_snapshot.discount_percent||0)+"%",1)])):r("",!0)]),t.value.proof_exists?(n(),i("div",$e,[e[33]||(e[33]=s("h4",null,"Payment Proof",-1)),D.value?(n(),i("div",ze,"Loading proof...")):m.value?(n(),i("div",Oe,[s("img",{src:m.value,alt:"Payment proof",class:"proof-image",onClick:J},null,8,Ge),e[31]||(e[31]=s("p",{class:"proof-hint"},"Click image to view full size",-1))])):(n(),i("div",He,[e[32]||(e[32]=s("p",null,"Could not load proof image",-1)),s("a",{href:V.value,target:"_blank",class:"proof-link"},"ðŸ“„ Download Proof",8,We)]))])):r("",!0)]),_:1})])])):r("",!0),_.value?(n(),N(L,{key:3,onClose:e[4]||(e[4]=p=>_.value=!1)},{header:l(()=>[...e[34]||(e[34]=[s("h3",null,"Approve Request",-1)])]),footer:l(()=>[d(f,{variant:"secondary",onClick:e[3]||(e[3]=p=>_.value=!1),disabled:g.value},{default:l(()=>[...e[39]||(e[39]=[u(" Cancel ",-1)])]),_:1},8,["disabled"]),d(f,{variant:"primary",onClick:z,disabled:g.value},{default:l(()=>[...e[40]||(e[40]=[u(" Confirm Approval ",-1)])]),_:1},8,["disabled"])]),default:l(()=>[s("div",Je,[e[38]||(e[38]=s("p",null,"Are you sure you want to approve this subscription request?",-1)),s("div",Ke,[e[35]||(e[35]=s("label",null,"Start Date (optional)",-1)),E(s("input",{type:"date","onUpdate:modelValue":e[2]||(e[2]=p=>C.start_date=p),min:U.value},null,8,Qe),[[F,C.start_date]]),e[36]||(e[36]=s("p",{class:"help-text"},"Leave empty to use today's date",-1))]),g.value?(n(),i("div",Xe,[...e[37]||(e[37]=[s("div",{class:"spinner-small"},null,-1),u(" Processing... ",-1)])])):r("",!0),w.value?(n(),i("div",Ye,o(w.value),1)):r("",!0)])]),_:1})):r("",!0),y.value?(n(),N(L,{key:4,onClose:e[7]||(e[7]=p=>y.value=!1)},{header:l(()=>[...e[41]||(e[41]=[s("h3",null,"Reject Request",-1)])]),footer:l(()=>[d(f,{variant:"secondary",onClick:e[6]||(e[6]=p=>y.value=!1),disabled:b.value},{default:l(()=>[...e[45]||(e[45]=[u(" Cancel ",-1)])]),_:1},8,["disabled"]),d(f,{variant:"danger",onClick:O,disabled:b.value||k.rejection_reason.length<10},{default:l(()=>[...e[46]||(e[46]=[u(" Confirm Rejection ",-1)])]),_:1},8,["disabled"])]),default:l(()=>[s("div",Ze,[e[44]||(e[44]=s("p",null,"Please provide a reason for rejecting this request:",-1)),s("div",es,[e[42]||(e[42]=s("label",null,"Rejection Reason *",-1)),E(s("textarea",{"onUpdate:modelValue":e[5]||(e[5]=p=>k.rejection_reason=p),rows:"4",placeholder:"Enter at least 10 characters..."},null,512),[[F,k.rejection_reason]]),s("p",ss,o(k.rejection_reason.length)+"/500",1)]),b.value?(n(),i("div",ts,[...e[43]||(e[43]=[s("div",{class:"spinner-small"},null,-1),u(" Processing... ",-1)])])):r("",!0),q.value?(n(),i("div",as,o(q.value),1)):r("",!0)])]),_:1})):r("",!0)]),_:1}))}},ms=K(os,[["__scopeId","data-v-1237e84a"]]);export{ms as default};
