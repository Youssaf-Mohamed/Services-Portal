import{B as W,P as ae,a as ne}from"./PageHeader-DedF_tvu.js";/* empty css                                                             */import{_ as H,o,c as a,a as e,t as n,F as x,f as D,n as N,d as _,g as v,h as ie,i as Z,j as U,k as V,l as E,m as C,p as M,b as F,q as A,s as Q,v as X,r as u}from"./index-Bc4wcCny.js";/* empty css                                                              *//* empty css                                                              */import{E as ue}from"./EmptyState-BhBk9IQP.js";import{M as re}from"./Modal-BPzgvptH.js";import{t as j}from"./transport.api-ktzYj7z7.js";const de={class:"route-card"},ce={class:"card-header"},pe={class:"route-title"},ve={class:"route-subtitle"},me={class:"stops-timeline"},ye={class:"stop-indicator"},fe={key:0,class:"stop-line"},_e={class:"stop-info"},be={class:"stop-name"},ge={class:"pricing-section"},ke={class:"price-item"},Pe={class:"price-value"},he={key:0,class:"original-price"},Se={class:"final-price"},we={key:1,class:"discount-badge"},$e={class:"price-item"},Me={class:"price-value"},Fe={key:0,class:"original-price"},Re={class:"final-price"},Te={key:1,class:"discount-badge"},xe={__name:"RouteCard",props:{route:{type:Object,required:!0}},emits:["subscribe"],setup(p){const h=p,i=v(()=>h.route.pricing||{}),S=v(()=>i.value.price_one_way||0),g=v(()=>i.value.monthly_discount_percent||0),f=v(()=>i.value.term_discount_percent||0),d=v(()=>S.value*2),m=v(()=>(d.value*5*4).toFixed(2)),b=v(()=>(d.value*5*12).toFixed(2)),k=v(()=>(parseFloat(m.value)*(1-g.value/100)).toFixed(2)),P=v(()=>(parseFloat(b.value)*(1-f.value/100)).toFixed(2));return(r,c)=>(o(),a("div",de,[e("div",ce,[e("h3",pe,n(p.route.name_ar),1),e("p",ve,n(p.route.name_en),1)]),e("div",me,[(o(!0),a(x,null,D(p.route.stops,(y,w)=>(o(),a("div",{key:y.id,class:"stop-item"},[e("div",ye,[e("div",{class:N(["stop-dot",{first:w===0,last:w===p.route.stops.length-1}])},null,2),w<p.route.stops.length-1?(o(),a("div",fe)):_("",!0)]),e("div",_e,[e("span",be,n(y.name_en),1)])]))),128))]),e("div",ge,[e("div",ke,[c[1]||(c[1]=e("span",{class:"price-label"},"Monthly Plan",-1)),e("span",Pe,[g.value?(o(),a("span",he," EGP "+n(m.value),1)):_("",!0),e("span",Se,"EGP "+n(k.value),1),g.value?(o(),a("span",we," -"+n(g.value)+"% ",1)):_("",!0)])]),e("div",$e,[c[2]||(c[2]=e("span",{class:"price-label"},"Term Plan",-1)),e("span",Me,[f.value?(o(),a("span",Fe," EGP "+n(b.value),1)):_("",!0),e("span",Re,"EGP "+n(P.value),1),f.value?(o(),a("span",Te," -"+n(f.value)+"% ",1)):_("",!0)])])]),e("button",{class:"btn-subscribe",onClick:c[0]||(c[0]=y=>r.$emit("subscribe",p.route))}," Subscribe ")]))}},De=H(xe,[["__scopeId","data-v-79609fd4"]]),Ce={key:0,class:"success-state"},Ue={key:1,class:"subscription-form"},Ve={key:0,class:"error-alert"},Oe={key:0},Ee={class:"form-section"},je={class:"form-section"},qe={class:"form-row"},Le={class:"form-group"},Be=["value"],Ge={class:"form-group"},Ie=["disabled"],We=["value"],Ae={class:"form-section"},Ne={class:"plan-options"},He={class:"plan-info"},Ye={class:"plan-discount"},ze={class:"plan-info"},Je={class:"plan-discount"},Ke={key:0,class:"price-display"},Qe={class:"form-section"},Xe={key:0,class:"loading-inline"},Ze=["value"],et={key:2,class:"help-text"},tt={class:"form-section"},st={class:"form-row"},ot={class:"form-group"},lt={class:"form-group"},at=["max"],nt={class:"form-section"},it={key:0,class:"file-preview"},ut=["src"],rt={class:"modal-actions"},dt={__name:"SubscribeModal",props:{route:{type:Object,required:!0},settings:{type:Object,default:()=>({days_per_week:5,weeks_in_month:4,weeks_in_term:12})}},emits:["close","submitted"],setup(p,{emit:h}){const i=p,S=h,g=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],f=u(!0),d=u("monthly"),m=u(""),b=u(""),k=u(""),P=u(""),r=u(""),c=u(null),y=u(null),w=u([]),q=u(!1),R=u(!1),Y=u(!1),$=u(""),O=u(null),z=v(()=>new Date().toISOString().split("T")[0]),ee=v(()=>i.route.slots?Object.keys(i.route.slots).map(l=>({value:parseInt(l),label:g[l]||`Day ${l}`})):[]),te=v(()=>!m.value||!i.route.slots?[]:i.route.slots[m.value]||[]),J=v(()=>d.value&&m.value!==""&&b.value&&k.value&&P.value.length>=8&&r.value&&c.value),K=v(()=>w.value.find(l=>l.id===k.value)),L=v(()=>{if(!i.route.pricing||!i.settings)return null;const t=i.route.pricing.price_one_way*2,s=i.settings.days_per_week||5;if(d.value==="monthly"){const T=i.settings.weeks_in_month||4,G=t*s*T,I=i.route.pricing.monthly_discount_percent||0;return(G*(1-I/100)).toFixed(2)}else{const T=i.settings.weeks_in_term||12,G=t*s*T,I=i.route.pricing.term_discount_percent||0;return(G*(1-I/100)).toFixed(2)}});ie(m,()=>{b.value=""});const se=async()=>{q.value=!0;try{const l=await j.getPaymentMethods();w.value=l.data||[]}catch(l){console.error("Failed to load payment methods:",l),$.value="Failed to load payment methods. Please try again."}finally{q.value=!1}},oe=l=>{const t=l.target.files[0];t&&(c.value=t,y.value=URL.createObjectURL(t))},le=async()=>{if(!(!J.value||R.value)){R.value=!0,$.value="",O.value=null;try{const l=new FormData;l.append("route_id",i.route.id),l.append("day_of_week",m.value),l.append("time",b.value),l.append("plan_type",d.value),l.append("payment_method_id",k.value),l.append("paid_from_number",P.value),l.append("paid_at",r.value),l.append("amount_paid",L.value),l.append("proof",c.value),await j.submitSubscriptionRequest(l),Y.value=!0,S("submitted")}catch(l){console.error("Submission error:",l),l.status===409?$.value=l.message||"You already have a pending or active subscription.":l.status===422?($.value=l.message||"Validation failed. Please check your inputs.",O.value=l.errors):$.value=l.message||"Failed to submit request. Please try again."}finally{R.value=!1}}},B=()=>{y.value&&URL.revokeObjectURL(y.value),S("close")};return Z(()=>{se(),r.value=z.value}),(l,t)=>(o(),U(C(re),{modelValue:f.value,"onUpdate:modelValue":t[7]||(t[7]=s=>f.value=s),onClose:B,size:"lg",title:`Subscribe to ${p.route.name_en}`},{default:V(()=>[Y.value?(o(),a("div",Ce,[t[9]||(t[9]=e("div",{class:"success-icon"},"✅",-1)),t[10]||(t[10]=e("h3",null,"Request Submitted Successfully!",-1)),t[11]||(t[11]=e("p",null,"Your subscription request has been submitted and is pending review.",-1)),E(C(W),{variant:"primary",onClick:B},{default:V(()=>[...t[8]||(t[8]=[M("Close",-1)])]),_:1})])):(o(),a("div",Ue,[$.value?(o(),a("div",Ve,[t[12]||(t[12]=e("strong",null,"Error:",-1)),M(" "+n($.value)+" ",1),O.value?(o(),a("ul",Oe,[(o(!0),a(x,null,D(O.value,(s,T)=>(o(),a("li",{key:T},n(T)+": "+n(s.join(", ")),1))),128))])):_("",!0)])):_("",!0),e("div",Ee,[t[15]||(t[15]=e("h3",null,"Route Details",-1)),e("p",null,[t[13]||(t[13]=e("strong",null,"Route:",-1)),M(" "+n(p.route.name_en),1)]),e("p",null,[t[14]||(t[14]=e("strong",null,"One-way price:",-1)),M(" EGP "+n(p.route.pricing?.price_one_way),1)])]),e("div",je,[t[20]||(t[20]=e("h3",null,"Select Day & Time",-1)),e("div",qe,[e("div",Le,[t[17]||(t[17]=e("label",null,"Day of Week",-1)),F(e("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>m.value=s),class:"form-control"},[t[16]||(t[16]=e("option",{value:""},"Select day",-1)),(o(!0),a(x,null,D(ee.value,s=>(o(),a("option",{key:s.value,value:s.value},n(s.label),9,Be))),128))],512),[[A,m.value]])]),e("div",Ge,[t[19]||(t[19]=e("label",null,"Departure Time",-1)),F(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>b.value=s),class:"form-control",disabled:!m.value},[t[18]||(t[18]=e("option",{value:""},"Select time",-1)),(o(!0),a(x,null,D(te.value,s=>(o(),a("option",{key:s,value:s},n(s),9,We))),128))],8,Ie),[[A,b.value]])])])]),e("div",Ae,[t[24]||(t[24]=e("h3",null,"Subscription Plan",-1)),e("div",Ne,[e("label",{class:N(["radio-option",{selected:d.value==="monthly"}])},[F(e("input",{type:"radio",value:"monthly","onUpdate:modelValue":t[2]||(t[2]=s=>d.value=s)},null,512),[[Q,d.value]]),e("div",He,[t[21]||(t[21]=e("span",{class:"plan-name"},"Monthly Plan",-1)),e("span",Ye,n(p.route.pricing?.monthly_discount_percent)+"% off",1)])],2),e("label",{class:N(["radio-option",{selected:d.value==="term"}])},[F(e("input",{type:"radio",value:"term","onUpdate:modelValue":t[3]||(t[3]=s=>d.value=s)},null,512),[[Q,d.value]]),e("div",ze,[t[22]||(t[22]=e("span",{class:"plan-name"},"Term Plan",-1)),e("span",Je,n(p.route.pricing?.term_discount_percent)+"% off",1)])],2)]),L.value?(o(),a("div",Ke,[t[23]||(t[23]=e("strong",null,"Amount to pay:",-1)),M(" EGP "+n(L.value),1)])):_("",!0)]),e("div",Qe,[t[26]||(t[26]=e("h3",null,"Payment Method",-1)),q.value?(o(),a("div",Xe,"Loading payment methods...")):F((o(),a("select",{key:1,"onUpdate:modelValue":t[4]||(t[4]=s=>k.value=s),class:"form-control"},[t[25]||(t[25]=e("option",{value:""},"Select payment method",-1)),(o(!0),a(x,null,D(w.value,s=>(o(),a("option",{key:s.id,value:s.id},n(s.name)+" - "+n(s.account_number),9,Ze))),128))],512)),[[A,k.value]]),K.value?.instructions?(o(),a("p",et,n(K.value.instructions),1)):_("",!0)]),e("div",tt,[t[29]||(t[29]=e("h3",null,"Payment Details",-1)),e("div",st,[e("div",ot,[t[27]||(t[27]=e("label",null,"Payment Phone Number",-1)),F(e("input",{type:"text","onUpdate:modelValue":t[5]||(t[5]=s=>P.value=s),placeholder:"e.g., 01012345678",class:"form-control"},null,512),[[X,P.value]])]),e("div",lt,[t[28]||(t[28]=e("label",null,"Payment Date",-1)),F(e("input",{type:"date","onUpdate:modelValue":t[6]||(t[6]=s=>r.value=s),class:"form-control",max:z.value},null,8,at),[[X,r.value]])])])]),e("div",nt,[t[30]||(t[30]=e("h3",null,"Upload Payment Proof",-1)),e("input",{type:"file",accept:"image/jpeg,image/png,image/webp",onChange:oe,class:"file-input",ref:"fileInput"},null,544),t[31]||(t[31]=e("p",{class:"help-text"},"Upload receipt/proof of payment (JPEG, PNG, or WebP, max 2MB)",-1)),y.value?(o(),a("div",it,[e("img",{src:y.value,alt:"Payment proof preview"},null,8,ut),e("span",null,n(c.value?.name),1)])):_("",!0)]),e("div",rt,[E(C(W),{variant:"text",onClick:B,disabled:R.value},{default:V(()=>[...t[32]||(t[32]=[M("Cancel",-1)])]),_:1},8,["disabled"]),E(C(W),{variant:"primary",onClick:le,disabled:!J.value||R.value},{default:V(()=>[M(n(R.value?"Submitting...":"Submit Request"),1)]),_:1},8,["disabled"])])]))]),_:1},8,["modelValue","title"]))}},ct=H(dt,[["__scopeId","data-v-4968c890"]]),pt={key:0,class:"loading-state"},vt={key:2,class:"routes-grid"},mt={__name:"TransportHome",setup(p){const h=u(!1),i=u(""),S=u([]),g=u(null),f=u(!1),d=u(null),m=async()=>{h.value=!0,i.value="";try{const[r,c]=await Promise.all([j.getRoutes(),j.getSettings()]);S.value=r.data||[],g.value=c.data||null}catch(r){console.error("Failed to load transport data:",r),i.value=r.message||"Failed to load routes"}finally{h.value=!1}},b=r=>{d.value=r,f.value=!0},k=()=>{f.value=!1,d.value=null},P=()=>{console.log("Subscription request submitted successfully")};return Z(()=>{m()}),(r,c)=>(o(),U(ne,null,{default:V(()=>[E(C(ae),{title:"Transportation",subtitle:"Browse available routes and subscribe to your preferred transportation plan",breadcrumbs:[{label:"Home",to:"/student/transport"},{label:"Transportation"}]}),h.value?(o(),a("div",pt,[...c[0]||(c[0]=[e("div",{class:"spinner"},null,-1),e("p",null,"Loading routes...",-1)])])):i.value?(o(),U(C(ue),{key:1,icon:"⚠️",title:"Failed to Load Routes",message:i.value,actionText:"Retry",onAction:m},null,8,["message"])):(o(),a("div",vt,[(o(!0),a(x,null,D(S.value,y=>(o(),U(De,{key:y.id,route:y,onSubscribe:b},null,8,["route"]))),128))])),f.value?(o(),U(ct,{key:3,route:d.value,settings:g.value,onClose:k,onSubmitted:P},null,8,["route","settings"])):_("",!0)]),_:1}))}},St=H(mt,[["__scopeId","data-v-f89235b3"]]);export{St as default};
