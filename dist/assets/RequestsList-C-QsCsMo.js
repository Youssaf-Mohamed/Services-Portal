import{_ as j,i as T,j as R,k as i,z,A as q,r as f,e as U,y as E,o as r,l as d,a as e,b,q as S,c as p,F as w,f as B,t as o,B as I,v as M,p as g,d as $}from"./index-Bc4wcCny.js";import{a as K,P as H,B as m}from"./PageHeader-DedF_tvu.js";import{B as C}from"./Badge-DkpUI6Z9.js";import{E as O}from"./EmptyState-BhBk9IQP.js";import{a as V}from"./adminTransport.api-C7MzCjLU.js";/* empty css                                                              */const Q={class:"filters-section"},G={class:"filters-row"},J={class:"filter-group"},W={class:"filter-group"},X=["value"],Y={class:"filter-group"},Z={key:0,class:"loading-state"},ee={key:1,class:"error-state"},te={key:3,class:"table-container"},se={class:"requests-table"},ae={class:"student-info"},ne={class:"student-name"},oe={class:"student-email"},re={key:0,class:"pagination"},le={class:"page-info"},ue={__name:"RequestsList",setup(ie){const u=z(),x=U(),_=f(!0),v=f(null),y=f([]),h=f([]),l=q({current_page:1,last_page:1,per_page:15,total:0}),s=q({status:"",route_id:"",search:"",page:1}),A=()=>{u.query.status&&(s.status=u.query.status),u.query.route_id&&(s.route_id=u.query.route_id),u.query.search&&(s.search=u.query.search),u.query.page&&(s.page=parseInt(u.query.page))},D=async()=>{try{const n=await V.getRoutes();n.data.success&&(h.value=n.data.data.routes)}catch(n){console.error("Failed to fetch routes:",n)}},c=async()=>{try{_.value=!0,v.value=null;const n={};s.status&&(n.status=s.status),s.route_id&&(n.route_id=s.route_id),s.search&&(n.search=s.search),s.page>1&&(n.page=s.page),x.replace({query:n});const t=await V.getRequests({status:s.status||void 0,route_id:s.route_id||void 0,search:s.search||void 0,page:s.page});t.data.success&&(y.value=t.data.data.requests,Object.assign(l,t.data.data.pagination))}catch(n){v.value=n.response?.data?.message||"Failed to load requests"}finally{_.value=!1}},F=()=>{s.status="",s.route_id="",s.search="",s.page=1,c()},k=n=>{s.page=n,c()},N=n=>{switch(n){case"pending":return"warning";case"approved":return"success";case"rejected":return"danger";default:return"secondary"}},P=n=>new Date(n).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});return T(()=>{A(),D(),c()}),(n,t)=>{const L=E("router-link");return r(),R(K,null,{default:i(()=>[d(H,{title:"Subscription Requests",subtitle:"Review and process transport subscription requests",breadcrumbs:[{label:"Admin",to:"/admin/transport"},{label:"Requests"}]}),e("div",Q,[e("div",G,[e("div",J,[t[6]||(t[6]=e("label",null,"Status",-1)),b(e("select",{"onUpdate:modelValue":t[0]||(t[0]=a=>s.status=a),onChange:c},[...t[5]||(t[5]=[e("option",{value:""},"All Statuses",-1),e("option",{value:"pending"},"Pending",-1),e("option",{value:"approved"},"Approved",-1),e("option",{value:"rejected"},"Rejected",-1)])],544),[[S,s.status]])]),e("div",W,[t[8]||(t[8]=e("label",null,"Route",-1)),b(e("select",{"onUpdate:modelValue":t[1]||(t[1]=a=>s.route_id=a),onChange:c},[t[7]||(t[7]=e("option",{value:""},"All Routes",-1)),(r(!0),p(w,null,B(h.value,a=>(r(),p("option",{key:a.id,value:a.id},o(a.name_en),9,X))),128))],544),[[S,s.route_id]])]),e("div",Y,[t[9]||(t[9]=e("label",null,"Search",-1)),b(e("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=a=>s.search=a),placeholder:"Name or email...",onKeyup:I(c,["enter"])},null,544),[[M,s.search]])]),d(m,{variant:"secondary",size:"sm",onClick:F},{default:i(()=>[...t[10]||(t[10]=[g(" Reset ",-1)])]),_:1})])]),_.value?(r(),p("div",Z,[...t[11]||(t[11]=[e("div",{class:"spinner"},null,-1),e("p",null,"Loading requests...",-1)])])):v.value?(r(),p("div",ee,[e("p",null,o(v.value),1),d(m,{variant:"primary",onClick:c},{default:i(()=>[...t[12]||(t[12]=[g("Retry",-1)])]),_:1})])):y.value.length===0?(r(),R(O,{key:2,icon:"ðŸ“‹",title:"No Requests Found",message:"There are no subscription requests matching your filters."})):(r(),p("div",te,[e("table",se,[t[14]||(t[14]=e("thead",null,[e("tr",null,[e("th",null,"ID"),e("th",null,"Student"),e("th",null,"Route"),e("th",null,"Plan"),e("th",null,"Status"),e("th",null,"Date"),e("th",null,"Actions")])],-1)),e("tbody",null,[(r(!0),p(w,null,B(y.value,a=>(r(),p("tr",{key:a.id},[e("td",null,"#"+o(a.id),1),e("td",null,[e("div",ae,[e("span",ne,o(a.user.name),1),e("span",oe,o(a.user.email),1)])]),e("td",null,o(a.route?.name_en||"N/A"),1),e("td",null,[d(C,{variant:a.plan_type==="monthly"?"info":"secondary"},{default:i(()=>[g(o(a.plan_type),1)]),_:2},1032,["variant"])]),e("td",null,[d(C,{variant:N(a.status)},{default:i(()=>[g(o(a.status),1)]),_:2},1032,["variant"])]),e("td",null,o(P(a.created_at)),1),e("td",null,[d(L,{to:`/admin/transport/requests/${a.id}`,class:"action-link"},{default:i(()=>[...t[13]||(t[13]=[g(" View Details ",-1)])]),_:1},8,["to"])])]))),128))])]),l.last_page>1?(r(),p("div",re,[d(m,{variant:"secondary",size:"sm",disabled:l.current_page===1,onClick:t[3]||(t[3]=a=>k(l.current_page-1))},{default:i(()=>[...t[15]||(t[15]=[g(" Previous ",-1)])]),_:1},8,["disabled"]),e("span",le," Page "+o(l.current_page)+" of "+o(l.last_page),1),d(m,{variant:"secondary",size:"sm",disabled:l.current_page===l.last_page,onClick:t[4]||(t[4]=a=>k(l.current_page+1))},{default:i(()=>[...t[16]||(t[16]=[g(" Next ",-1)])]),_:1},8,["disabled"])])):$("",!0)]))]),_:1})}}},me=j(ue,[["__scopeId","data-v-d386afba"]]);export{me as default};
